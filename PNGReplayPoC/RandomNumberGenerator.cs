using System;

namespace PNGReplayPoC.RandomNumberGeneration;

// Simple dumb custom implementation of a random number generator to have access to it's seed and next index in the series,
// just for the sake of this proof of concept. For reproducibility, we would need to save those numbers and use them
// after restoring a game state.
public struct RandomNumberGenerator
{
    public int NextIndex;

    public RandomNumberGenerator(int seed = 0)
    {
        NextIndex = seed % _precomputedNumbers.Length;
        if (NextIndex < 0) NextIndex += _precomputedNumbers.Length;
    }

    public RandomNumberGenerator(int seed = 0, int nextIndex = 0)
    {
        if (nextIndex < 0 || nextIndex >= _precomputedNumbers.Length)
            throw new ArgumentException($"nextIndex must be between 0 and {_precomputedNumbers.Length - 1}");

        NextIndex = seed % _precomputedNumbers.Length;
        if (NextIndex < 0) NextIndex += _precomputedNumbers.Length;
    }

    public double NextDouble()
    {
        double next = _precomputedNumbers[NextIndex];

        if (++NextIndex == _precomputedNumbers.Length) NextIndex = 0;
        return next;
    }
    
    /// Returns a random integer in the range [minValue,maxValue)
    public int Next(int minValue = 0, int maxValue = int.MaxValue)
    {
        if (maxValue <= minValue)
            throw new ArgumentException("max must be greater than min");

        int range = maxValue - minValue;

        int value = (int)(NextDouble() * range);

        return minValue + value;
    }

    public bool NextBool()
    {
        double value = NextDouble();
        return value > 0.5;
    }
    
    private readonly double[] _precomputedNumbers =
    {
        0.548813502304256, 0.5928446163889021, 0.715189364971593, 0.8442657440900803, 0.6027633703779429, 0.8579456198494881, 0.5448831773828715, 0.8472517372574657,
        0.42365479678846896, 0.6235636963974684, 0.6458941150922328, 0.3843817082233727, 0.43758720997720957, 0.29753460525535047, 0.8917730017565191, 0.05671297572553158,
        0.963662764057517, 0.27265629451721907, 0.38344152132049203, 0.4776651116553694, 0.79172503342852, 0.8121687264647335, 0.5288949215319008, 0.4799771714024246,
        0.568044563755393, 0.3927847931627184, 0.925596633227542, 0.8360787688288838, 0.07103605871088803, 0.3373961616307497, 0.08712929696775973, 0.6481718765571713,
        0.020218399120494723, 0.3682415373623371, 0.8326198428403586, 0.9571551543194801, 0.778156756889075, 0.14035077742300928, 0.8700121452566236, 0.8700872510671616,
        0.9786183428950608, 0.47360804001800716, 0.799158563837409, 0.8009107524994761, 0.4614793627988547, 0.520477480487898, 0.780529175652191, 0.6788795336615294,
        0.11827442375943065, 0.7206326515879482, 0.6399210169911385, 0.5820197912398726, 0.14335328550077975, 0.537373228231445, 0.9446689186152071, 0.7586156204342842,
        0.5218483281787485, 0.10590760642662644, 0.4146619411185384, 0.4736004227306694, 0.26455561141483486, 0.1863323445431888, 0.7742336865048856, 0.736918177921325,
        0.4561503359582275, 0.216550356708467, 0.5684339483268559, 0.13521817326545715, 0.01878979802131653, 0.3241410041227937, 0.617635500850156, 0.14967486378736794,
        0.6120957224629819, 0.2223213855177164, 0.6169339986518025, 0.3864889780525118, 0.9437480752822012, 0.9025984713807702, 0.6818202978465706, 0.4499499895609915,
        0.35950790205970407, 0.6130634618457407, 0.4370319526642561,  0.9023485782090575, 0.6976311954203993, 0.09928035154007375, 0.060225466499105096, 0.9698090685997158,
        0.6667667112778872, 0.6531400321982801, 0.6706378736998886, 0.17090958612971008, 0.21038256166502833, 0.35815217019990087, 0.1289262983482331, 0.7506861388683319,
        0.31542834965512156, 0.6078306667041034, 0.3637107734102756, 0.32504722755402327, 0.5701967759523541, 0.03842542553320527, 0.4386015133932233, 0.6342740531545132,
        0.98837383184582, 0.9589492692612112, 0.10204480681568384, 0.6527903189416975, 0.2088767585810274, 0.6350588770583272, 0.16130951116792858, 0.9952995656058192,
        0.6531083220615983, 0.5818503322079778, 0.2532916013151407, 0.41436858801171184, 0.46631077281199396, 0.4746975051239133, 0.24442558805458248, 0.6235101060010493,
        0.15896958648227155, 0.33800761750899255, 0.11037513916380703, 0.6747523222584277, 0.6563295919913799, 0.31720174476504326, 0.138182949507609, 0.7783454817254096,
        0.1965823567006737, 0.9495710514020175, 0.36872516572475433, 0.662526868050918, 0.8209932309109718, 0.013571641873568296, 0.09710127115249634, 0.6228460932616144,
        0.8379449066706002, 0.6736596310511231, 0.09609840111806989, 0.9719449989497662, 0.9764594652224332, 0.8781934685539454, 0.4686511983163655, 0.5096243717707694,
        0.9767610908020288, 0.055714692920446396, 0.6048455180134624, 0.45115921390242875, 0.7392635813448578, 0.01998767233453691, 0.03918778896331787, 0.44171092147007585,
        0.28280695946887136, 0.9795867304783314, 0.12019656458869576, 0.3594444689806551, 0.2961401992943138, 0.4808935362379998, 0.11872771428897977, 0.6886611862573773,
        0.3179831732995808, 0.880475893151015, 0.41426298837177455, 0.918235472869128, 0.06414750101976097, 0.2168221331667155, 0.6924721193499863, 0.5651888656429946,
        0.5666014484595507, 0.8651025639846921, 0.2653894911054522, 0.5089689609594643, 0.5232480529230088, 0.9167229565791786, 0.09394050599075854, 0.9211576119996607,
        0.5759464951697737, 0.08311248663812876, 0.929296197835356, 0.277718564029783, 0.31856895494274795, 0.009356701746582985, 0.6674103762488812, 0.8423420791514218,
        0.13179786200635135, 0.6471741385757923, 0.7163271978497505, 0.8413861221633852, 0.28940609097480774, 0.2647301643155515, 0.18319136346690357, 0.39782075164839625,
        0.5865129330195487, 0.5528214841615409, 0.02010755054652691, 0.16494046058505774, 0.8289400283247232, 0.3698080957401544, 0.004695482086390257, 0.14644176326692104,
        0.677816539304331, 0.5696184043772519, 0.2700079686474055, 0.7037372807972133, 0.7351940204389393, 0.28847643244080245, 0.962188544915989, 0.4332880638539791,
        0.24875313974916935, 0.7561066914349794, 0.576157335890457, 0.39609827823005617, 0.592041926458478, 0.8960383892990649, 0.5722519014962018, 0.6389210801571608,
        0.22308163065463305, 0.8915544308256358, 0.952749009244144, 0.6800555728841573, 0.4471253785304725, 0.4491977319121361, 0.8464086661115289, 0.9785709239076823,
        0.699479277478531, 0.11620190995745361, 0.2974369516596198, 0.7670237026177347, 0.8137978196609765, 0.4118201418314129, 0.39650573884136975, 0.6754390771966428,
        0.8811032008379698, 0.249796275049448, 0.5812728758901358, 0.3132183321285993, 0.881735359551385, 0.9654162186197937, 0.6925315915141255, 0.5884650833904743,
        0.725254281423986, 0.6596684141550213, 0.5013243830762804, 0.5332062516827136, 0.9560836397577077, 0.2305330231320113, 0.6439901965204626, 0.3948692921549082,
        0.4238550439476967, 0.6188085610046983, 0.6063932168763131, 0.474867521552369, 0.019193200627341866, 0.4701321884058416, 0.3015748162288219, 0.716074533527717,
        0.6601735383737832, 0.2879910038318485, 0.29007760994136333, 0.3834622260183096, 0.618015426909551, 0.7491698360536247, 0.42876869859173894, 0.8784521911293268,
        0.13547406857833266, 0.10286335996352136, 0.29828232782892883, 0.09237388661131263, 0.5699649115558714, 0.3540466644335538, 0.5908727629575878, 0.5518162550870329,
        0.5743252558168024, 0.03362509375438094, 0.6532008154317737, 0.9689617659896612, 0.6521032743621618, 0.32099724374711514, 0.43141843448393047, 0.22126268269494176,
        0.8965465982910246, 0.14126390288583934, 0.36756187165156007, 0.09725992660969496, 0.43586491933092475, 0.9840422354172915, 0.8919233581982553, 0.2603409285657108,
        0.8061939917970449, 0.5370225172955543, 0.7038885855581611, 0.44792617368511856, 0.10022688657045364, 0.09956908482126892, 0.9194826129823923, 0.35231166053563356,
        0.7142412983812392, 0.46924917167052627, 0.9988470028620213, 0.8411401298362762, 0.14944830466993153, 0.9046477442607284, 0.8681260605808347, 0.03755938448011875,
        0.16249293135479093, 0.5083154502790421, 0.6155595674645156, 0.16684751794673502, 0.12381998240016401, 0.7790510181803256, 0.8480082273017615, 0.8649332928471267,
        0.8073189603164792, 0.41139672440476716, 0.569100744323805, 0.1399725831579417, 0.4071832976769656, 0.033222386380657554, 0.06916699022985995, 0.9825749567244202,
        0.6974287724588066, 0.3732907527592033, 0.4535426802467555, 0.42007536767050624, 0.7220556051470339, 0.05058811279013753, 0.8663823259994388, 0.36549609969370067,
        0.9755215120967478, 0.01662796945311129, 0.8558033430017531, 0.23074234160594642, 0.011714081512764096, 0.7649116979446262, 0.3599780590739101, 0.9441235207486898,
        0.7299905617255718, 0.7499992477241904, 0.1716296775266528, 0.3394038160331547, 0.5210366030223668, 0.48954894207417965, 0.05433798604644835, 0.33898511645384133,
        0.19999652542173862, 0.1794902679976076, 0.018521794117987156, 0.1709865927696228, 0.7936977024655789, 0.46345097618177533, 0.2239246827084571, 0.8745729620568454,
        0.345351678552106, 0.9441197509877384, 0.9280812926590443, 0.608252867590636, 0.7044143993407488, 0.5966554128099233, 0.03183892392553389, 0.7836442480329424,
        0.1646941564977169, 0.5000262937974185, 0.6214784067124128, 0.05037005874328315, 0.5772285852581263, 0.6990980776026845, 0.23789281491190195, 0.9923963956534863,
        0.9342140017542988, 0.26726253400556743, 0.6139659525360912, 0.6790906181558967, 0.5356327972840518, 0.8642814424820244, 0.5899099777452648, 0.7508442469406873,
        0.7301220262888819, 0.9644897656980902, 0.31194499554112554,  0.5542424360755831, 0.39822106738574803, 0.21239050198346376, 0.20984375406987965, 0.22244322346523404,
        0.18619300541467965, 0.21874936786480248, 0.9443723885342479, 0.569573531858623, 0.7395507965702564, 0.45210903813131154, 0.4904588018544018, 0.9702366848941892,
        0.22741462918929756, 0.6805446941871196, 0.254356482764706, 0.08529556705616415, 0.058029162464663386, 0.05641833459958434, 0.43441662890836596, 0.4878377059940249,
        0.311795876827091, 0.8810045586433262, 0.6963434857316315, 0.9764043902978301, 0.3777518372517079, 0.6176579191815108, 0.17960367747582495, 0.5424987769220024,
        0.024678728776052594, 0.8546135830692947, 0.0672496308106929, 0.743834542343393, 0.679392775753513, 0.47859632642939687, 0.4536968395113945, 0.6770815763156861,
        0.5365792086813599, 0.607045060954988, 0.8966712902765721, 0.714696932816878, 0.9903389459941536, 0.46949718752875924, 0.21689698100090027, 0.4560146233998239,
        0.6630782035645097, 0.9064180888235569, 0.26332237804308534, 0.13722042087465525, 0.020651004742830992, 0.2292193230241537, 0.7583786519244313, 0.8815854040440172,
        0.3200171447824687, 0.9044249772559851, 0.383463891223073, 0.6457845997065306, 0.5883171174209565, 0.3246829726267606, 0.8310484576504678, 0.5197111922316253,
        0.6289818489458412, 5.535036325454712e-05, 0.8726506575476378, 0.3118602205067873, 0.27354203327558935, 0.42545153736136854
    };
}